@using FormBuilder.Models

<RadzenRow Class="vh-100">
    <RadzenColumn Size="12" SizeMD="9" SizeLG="10">
        <RadzenStack Orientation="Orientation.Vertical" Gap="1rem">
            @if (_formDefinition.Id is not null)
            {
                <RadzenFormField Text="Form ID">
                    <RadzenTextBox Value="@_formDefinition.Id" ReadOnly="true"/>
                </RadzenFormField>
            }

            <RadzenFormField Text="Form Name">
                <RadzenTextBox @bind-Value="_formDefinition.Name"/>
            </RadzenFormField>

            <DropZone TData="Func<Task>" Drop="(func) => func()" Zone="FieldsZone">
                <RadzenFieldset Text="Fields" Style="max-height: 600px; overflow-y: auto">
                    <RadzenStack Orientation="Orientation.Vertical" Gap="0.5rem">
                        @foreach (var field in _formDefinition.Fields)
                        {
                            <Dragable Data="field" Zone="FieldItemZone">
                                <DropZone TData="Field"
                                          Zone="FieldItemZone"
                                          Drop="(droppingField) => SwapFields(field, droppingField)"
                                          @onclick="() => SelectedField = field">
                                    <FormField Field="field" Disabled="true">
                                        <Append>
                                            <RadzenButton
                                                Icon="delete"
                                                Size="ButtonSize.Small"
                                                ButtonStyle="ButtonStyle.Danger"
                                                Click="() => RemoveField(field)">
                                            </RadzenButton>
                                        </Append>
                                    </FormField>
                                </DropZone>
                            </Dragable>
                        }
                    </RadzenStack>
                </RadzenFieldset>
            </DropZone>
            
            <RadzenFormField Text="Generated JSON">
                <RadzenTextArea @bind-Value="_formDesignJson" Rows="20" ReadOnly="true"/>
            </RadzenFormField>
        </RadzenStack>
    </RadzenColumn>
    
    <RadzenColumn Class="border bg-light px-1" Size="12" SizeMD="3" SizeLG="2">
        <RadzenStack Class="pt-2" Orientation="Orientation.Vertical">
            <RadzenText TextStyle="TextStyle.H5" TextAlign="TextAlign.Center">Fields</RadzenText>
            <Dragable Data="() => AddField(FieldType.Text)" Zone="FieldsZone">
                <RadzenButton Class="w-100" Text="Text Field" Click="() => AddField(FieldType.Text)"/>
            </Dragable>
            <Dragable Data="() => AddField(FieldType.NumericInt)" Zone="FieldsZone">
                <RadzenButton Class="w-100" Text="Integer Field" Click="() => AddField(FieldType.NumericInt)"/>
            </Dragable>
            <Dragable Data="() => AddField(FieldType.NumericDecimal)" Zone="FieldsZone">
                <RadzenButton Class="w-100" Text="Decimal Field" Click="() => AddField(FieldType.NumericDecimal)"/>
            </Dragable>
            <Dragable Data="() => AddField(FieldType.Date)" Zone="FieldsZone">
                <RadzenButton Class="w-100" Text="Date Field" Click="() => AddField(FieldType.Date)"/>
            </Dragable>
            <Dragable Data="() => AddField(FieldType.Select)" Zone="FieldsZone">
                <RadzenButton Class="w-100" Text="Select Field" Click="() => AddField(FieldType.Select)"/>
            </Dragable>
            <hr/>
        </RadzenStack>
        <RadzenStack Orientation="Orientation.Vertical" Gap="1rem">
            <RadzenText TextStyle="TextStyle.H5" TextAlign="TextAlign.Center">Properties</RadzenText>
            <FieldPropertyEditor 
                @bind-Field="SelectedField" 
                PropertyChanged="(e) => HandleFieldPropertyChanged(e)">
            </FieldPropertyEditor>
            <hr/>
            <RadzenButton Text="Save Form" Click="SaveFormAsync" Disabled="IsLoading"/>
            <RadzenButton Text="Load Form" Click="OpenLoadFormDialogAsync" Disabled="IsLoading"/>
        </RadzenStack>
    </RadzenColumn>
</RadzenRow>
